<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Integration Test - Timothie & Co</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Timothie & Co - Cart Integration Test</h1>
    <p>This page tests the cart integration functionality in the jewelry customizer.</p>

    <div class="test-section">
        <h2>HTML Structure Tests</h2>
        <div id="html-tests"></div>
        <button onclick="runHTMLTests()">Run HTML Tests</button>
    </div>

    <div class="test-section">
        <h2>CSS Style Tests</h2>
        <div id="css-tests"></div>
        <button onclick="runCSSTests()">Run CSS Tests</button>
    </div>

    <div class="test-section">
        <h2>JavaScript Module Tests</h2>
        <div id="js-tests"></div>
        <button onclick="runJSTests()">Run JS Tests</button>
    </div>

    <div class="test-section">
        <h2>Integration Test Summary</h2>
        <div id="summary"></div>
        <button onclick="runAllTests()">Run All Tests</button>
    </div>

    <script>
        let testResults = {
            html: [],
            css: [],
            js: [],
            overall: 'pending'
        };

        function addTestResult(category, test, passed, message) {
            testResults[category].push({
                test: test,
                passed: passed,
                message: message
            });
        }

        function displayResults(category, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            testResults[category].forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'success' : 'error'}`;
                div.innerHTML = `
                    <strong>${result.test}:</strong> 
                    ${result.passed ? '✓ PASS' : '✗ FAIL'} - 
                    ${result.message}
                `;
                container.appendChild(div);
            });
        }

        function runHTMLTests() {
            testResults.html = [];
            
            // Test 1: Cart icon container exists
            const cartIconContainer = document.getElementById('cart-icon-container');
            addTestResult('html', 'Cart Icon Container', 
                !!cartIconContainer, 
                cartIconContainer ? 'Container found in header' : 'Container missing from header'
            );

            // Test 2: Cart sidebar container exists  
            const cartSidebarContainer = document.getElementById('cart-sidebar-container');
            addTestResult('html', 'Cart Sidebar Container',
                !!cartSidebarContainer,
                cartSidebarContainer ? 'Container found in sidebar' : 'Container missing from sidebar'
            );

            // Test 3: Add to cart button exists
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            addTestResult('html', 'Add to Cart Button',
                !!addToCartBtn,
                addToCartBtn ? 'Button found in controls' : 'Button missing from controls'
            );

            // Test 4: Quick add section exists
            const quickAddSection = document.querySelector('.quick-add-section');
            addTestResult('html', 'Quick Add Section',
                !!quickAddSection,
                quickAddSection ? 'Section found in sidebar' : 'Section missing from sidebar'
            );

            // Test 5: Export to cart option exists
            const cartExportOption = document.querySelector('input[value="cart"]');
            addTestResult('html', 'Cart Export Option',
                !!cartExportOption,
                cartExportOption ? 'Option found in export modal' : 'Option missing from export modal'
            );

            displayResults('html', 'html-tests');
        }

        function runCSSTests() {
            testResults.css = [];
            
            // Test cart-specific CSS classes
            const testClasses = [
                'cart-section',
                'cart-header', 
                'cart-toggle-btn',
                'quick-add-section',
                'quick-add-tabs',
                'quick-add-item',
                'cart-action'
            ];

            testClasses.forEach(className => {
                const element = document.querySelector(`.${className}`);
                const hasStyles = element && window.getComputedStyle(element).display !== '';
                addTestResult('css', `${className} styles`,
                    hasStyles,
                    hasStyles ? 'Styles applied correctly' : 'Styles missing or not applied'
                );
            });

            displayResults('css', 'css-tests');
        }

        async function runJSTests() {
            testResults.js = [];

            try {
                // Test 1: Main script loads
                const scriptTag = document.querySelector('script[src*="main.js"]');
                addTestResult('js', 'Main Script Tag',
                    !!scriptTag,
                    scriptTag ? 'Script tag found' : 'Script tag missing'
                );

                // Test 2: Konva library loads
                const konvaScript = document.querySelector('script[src*="konva"]');
                addTestResult('js', 'Konva Library',
                    !!konvaScript,
                    konvaScript ? 'Konva script tag found' : 'Konva script tag missing'
                );

                // Test 3: Module type is set
                const moduleScript = document.querySelector('script[type="module"]');
                addTestResult('js', 'ES6 Module Support',
                    !!moduleScript,
                    moduleScript ? 'Module script found' : 'Module script missing'
                );

                // Test 4: Check if global objects would be available
                addTestResult('js', 'Global Environment',
                    typeof window !== 'undefined',
                    'Window object available for testing'
                );

            } catch (error) {
                addTestResult('js', 'JavaScript Execution',
                    false,
                    `Error during JS tests: ${error.message}`
                );
            }

            displayResults('js', 'js-tests');
        }

        function runAllTests() {
            runHTMLTests();
            runCSSTests();
            runJSTests();
            
            // Calculate overall results
            const allTests = [...testResults.html, ...testResults.css, ...testResults.js];
            const passedTests = allTests.filter(t => t.passed).length;
            const totalTests = allTests.length;
            const passRate = Math.round((passedTests / totalTests) * 100);
            
            testResults.overall = passRate >= 80 ? 'success' : passRate >= 60 ? 'warning' : 'error';
            
            const summaryContainer = document.getElementById('summary');
            summaryContainer.innerHTML = `
                <div class="test-result ${testResults.overall === 'success' ? 'success' : testResults.overall === 'warning' ? 'info' : 'error'}">
                    <h3>Integration Test Results</h3>
                    <p><strong>Tests Passed:</strong> ${passedTests} / ${totalTests} (${passRate}%)</p>
                    <p><strong>Status:</strong> ${
                        testResults.overall === 'success' ? '✓ Ready for Production' :
                        testResults.overall === 'warning' ? '⚠ Minor Issues Found' :
                        '✗ Major Issues Found'
                    }</p>
                    <p><strong>Recommendation:</strong> ${
                        testResults.overall === 'success' ? 'Cart integration is working properly!' :
                        testResults.overall === 'warning' ? 'Review failed tests and fix minor issues' :
                        'Fix critical issues before deployment'
                    }</p>
                </div>
            `;
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Simulate the actual page structure for testing
            createTestElements();
            setTimeout(runAllTests, 500);
        });

        function createTestElements() {
            // Create test elements that match the actual customizer structure
            const body = document.body;
            
            // Create header cart container
            const headerCartDiv = document.createElement('div');
            headerCartDiv.id = 'cart-icon-container';
            headerCartDiv.className = 'header-cart-container';
            body.appendChild(headerCartDiv);

            // Create sidebar cart container
            const cartSidebarDiv = document.createElement('div');
            cartSidebarDiv.id = 'cart-sidebar-container';
            cartSidebarDiv.className = 'cart-container';
            body.appendChild(cartSidebarDiv);

            // Create add to cart button
            const addToCartBtn = document.createElement('button');
            addToCartBtn.id = 'add-to-cart-btn';
            addToCartBtn.className = 'control-btn primary cart-action';
            addToCartBtn.innerHTML = '<span class="btn-icon">🛒</span> Add Design to Cart';
            body.appendChild(addToCartBtn);

            // Create quick add section
            const quickAddSection = document.createElement('section');
            quickAddSection.className = 'quick-add-section';
            quickAddSection.innerHTML = `
                <h3 class="section-title">Quick Add to Cart</h3>
                <div class="quick-add-tabs">
                    <button class="quick-add-tab active">Chains</button>
                    <button class="quick-add-tab">Charms</button>
                </div>
            `;
            body.appendChild(quickAddSection);

            // Create cart export option
            const cartExportInput = document.createElement('input');
            cartExportInput.type = 'radio';
            cartExportInput.name = 'export-format';
            cartExportInput.value = 'cart';
            body.appendChild(cartExportInput);

            // Create cart section elements
            const cartSection = document.createElement('section');
            cartSection.className = 'cart-section';
            cartSection.innerHTML = `
                <div class="cart-header">
                    <h3>Shopping Cart</h3>
                    <button class="cart-toggle-btn">▲</button>
                </div>
            `;
            body.appendChild(cartSection);
        }
    </script>
</body>
</html>